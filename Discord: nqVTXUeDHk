-- ModuleScript: GitanXUI_perfect
-- Full-featured, polished UI inspired by modern Roblox menu libraries.
-- Place this ModuleScript in StarterPlayerScripts or ReplicatedStorage.
-- Usage:
--   local GitanXUI = require(path.to.GitanXUI_perfect)
--   local win = GitanXUI.CreateWindow({Name="GitanX", Title="GitanX Hub", Size = Vector2.new(760,480)})
--   local tab = win:CreateTab("Fishing")
--   local sec = tab:CreateSection("Actions")
--   local toggle = sec:CreateToggle({Name="Auto Fish", Default=false, Callback=function(v) print(v) end})
--   local slider = sec:CreateSlider({Name="Power", Min=1, Max=4, Default=2, Step=1, Reversed=false, Callback=function(v) print(v) end})

local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")

local GitanXUI = {}
GitanXUI.__version = "4.0.0-perfect"

-- Default theme
GitanXUI.DefaultTheme = {
    WindowBg = Color3.fromRGB(18,20,24),
    TitleBg  = Color3.fromRGB(12,88,200),
    TabsBg   = Color3.fromRGB(28,30,34),
    ContentBg = Color3.fromRGB(14,16,18),
    Accent    = Color3.fromRGB(85,170,255),
    Primary   = Color3.fromRGB(44,48,56),
    Text      = Color3.fromRGB(240,240,240),
    Muted     = Color3.fromRGB(160,160,160),
    NotificationBg = Color3.fromRGB(10,10,12),
}

-- Small helpers
local function safeTween(inst, props, time, style, dir)
    time = time or 0.18
    style = style or Enum.EasingStyle.Quad
    dir = dir or Enum.EasingDirection.Out
    pcall(function()
        local info = TweenInfo.new(time, style, dir)
        local t = TweenService:Create(inst, info, props)
        t:Play()
    end)
end

local function clamp(v, a, b)
    if a and v < a then return a end
    if b and v > b then return b end
    return v
end

local function makeCorner(parent, radius)
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0, radius or 8)
    c.Parent = parent
    return c
end

local function makeStroke(parent, color, thickness, trans)
    local s = Instance.new("UIStroke")
    s.Color = color or Color3.new(0,0,0)
    s.Thickness = thickness or 1
    s.Transparency = trans or 0.9
    s.Parent = parent
    return s
end

local function makeGradient(parent, a, b, rot)
    local g = Instance.new("UIGradient")
    g.Color = ColorSequence.new(a, b or a)
    if rot then g.Rotation = rot end
    g.Parent = parent
    return g
end

local function getPlayerGui()
    local pl = Players.LocalPlayer
    if pl then return pl:WaitForChild("PlayerGui") end
    return game:GetService("CoreGui")
end

local function ripple(parent, x, y, color)
    pcall(function()
        local r = Instance.new("Frame", parent)
        r.AnchorPoint = Vector2.new(0.5, 0.5)
        r.Position = UDim2.new(0, x, 0, y)
        r.Size = UDim2.fromOffset(10, 10)
        r.BackgroundColor3 = color or Color3.new(1,1,1)
        r.BackgroundTransparency = 0.6
        r.ZIndex = (parent.ZIndex or 1) + 5
        makeCorner(r, 99)
        safeTween(r, {Size = UDim2.fromScale(8,8), BackgroundTransparency = 1}, 0.45)
        delay(0.55, function() if r and r.Parent then r:Destroy() end end)
    end)
end

-- Notifications queue
local function enqueueNotification(win, title, text, duration)
    duration = duration or 3
    win._notifQueue = win._notifQueue or {}
    table.insert(win._notifQueue, {title = title, text = text, duration = duration})
    if win._notifRunning then return end
    win._notifRunning = true
    spawn(function()
        while #win._notifQueue > 0 do
            local n = table.remove(win._notifQueue, 1)
            local notif = Instance.new("Frame", win.ScreenGui)
            notif.Size = UDim2.fromOffset(360, 72)
            notif.Position = UDim2.new(0.5, -180, 0.12, 0)
            notif.AnchorPoint = Vector2.new(0.5, 0)
            notif.BackgroundColor3 = win.Theme.NotificationBg
            notif.ZIndex = 3000
            makeCorner(notif, 10); makeStroke(notif, Color3.fromRGB(0,0,0),1,0.9)
            local tlabel = Instance.new("TextLabel", notif)
            tlabel.Size = UDim2.new(1, -12, 0, 20); tlabel.Position = UDim2.new(0,6,0,6)
            tlabel.BackgroundTransparency = 1; tlabel.Font = Enum.Font.GothamBold; tlabel.TextSize = 14
            tlabel.TextColor3 = win.Theme.Text; tlabel.TextXAlignment = Enum.TextXAlignment.Left; tlabel.Text = n.title or ""
            local txt = Instance.new("TextLabel", notif)
            txt.Size = UDim2.new(1, -12, 0, 36); txt.Position = UDim2.new(0,6,0,26)
            txt.BackgroundTransparency = 1; txt.Font = Enum.Font.Gotham; txt.TextSize = 13; txt.TextColor3 = win.Theme.Muted; txt.Text = n.text or ""
            safeTween(notif, {Position = UDim2.new(0.5, -180, 0.14, 0), BackgroundTransparency = 0}, 0.18)
            wait(n.duration)
            safeTween(notif, {Position = UDim2.new(0.5, -180, 0.10, 0)}, 0.16)
            wait(0.25)
            notif:Destroy()
        end
        win._notifRunning = false
    end)
end

local function CreateScreenGui(name)
    local pg = getPlayerGui()
    local sg = Instance.new("ScreenGui")
    sg.Name = name or ("GitanXUI_" .. tostring(math.random(1000,9999)))
    sg.IgnoreGuiInset = true
    sg.ResetOnSpawn = false
    sg.Parent = pg
    return sg
end

-- CreateWindow (factory)
function GitanXUI.CreateWindow(opts)
    opts = opts or {}
    local width = (opts.Size and opts.Size.X) or 760
    local height = (opts.Size and opts.Size.Y) or 480

    local sg = CreateScreenGui(opts.Name or "GitanXUI")
    local frame = Instance.new("Frame", sg)
    frame.Name = "GitanX_Window"
    frame.Size = UDim2.fromOffset(width, height)
    frame.Position = UDim2.new(0.5, -width/2, 0.5, -height/2)
    frame.AnchorPoint = Vector2.new(0.5, 0.5)
    frame.BackgroundColor3 = (opts.Theme and opts.Theme.WindowBg) or GitanXUI.DefaultTheme.WindowBg
    frame.ZIndex = 50
    makeCorner(frame, 14); makeStroke(frame, Color3.fromRGB(0,0,0),1,0.9)

    -- top glow / title
    local topGlow = Instance.new("Frame", frame)
    topGlow.Size = UDim2.new(1,0,0,6); topGlow.Position = UDim2.new(0,0,0,0)
    topGlow.BackgroundColor3 = (opts.Theme and opts.Theme.Accent) or GitanXUI.DefaultTheme.Accent
    topGlow.BackgroundTransparency = 0.78
    makeCorner(topGlow, 12); makeGradient(topGlow, Color3.fromRGB(255,255,255), topGlow.BackgroundColor3, 0)

    local titleBar = Instance.new("Frame", frame)
    titleBar.Size = UDim2.new(1,0,0,52); titleBar.Position = UDim2.new(0,0,0,6)
    titleBar.BackgroundColor3 = (opts.Theme and opts.Theme.TitleBg) or GitanXUI.DefaultTheme.TitleBg
    makeCorner(titleBar, 10); makeStroke(titleBar, Color3.fromRGB(0,0,0),1,0.9)

    local titleLabel = Instance.new("TextLabel", titleBar)
    titleLabel.Size = UDim2.new(1, -260, 1, 0); titleLabel.Position = UDim2.new(0, 16, 0, 0)
    titleLabel.BackgroundTransparency = 1; titleLabel.Font = Enum.Font.GothamBold; titleLabel.TextSize = 18
    titleLabel.Text = opts.Title or "GitanX UI"; titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.TextColor3 = (opts.Theme and opts.Theme.Text) or GitanXUI.DefaultTheme.Text

    local subtitle = Instance.new("TextLabel", titleBar)
    subtitle.Size = UDim2.new(0,240,0,18); subtitle.Position = UDim2.new(0, 16, 1, -20)
    subtitle.BackgroundTransparency = 1; subtitle.Font = Enum.Font.Gotham; subtitle.TextSize = 12
    subtitle.Text = opts.Subtitle or ""; subtitle.TextColor3 = (opts.Theme and opts.Theme.Muted) or GitanXUI.DefaultTheme.Muted

    local closeBtn = Instance.new("TextButton", titleBar)
    closeBtn.Size = UDim2.fromOffset(36,28); closeBtn.Position = UDim2.new(1, -48, 0, 12)
    closeBtn.Text = "âœ•"; closeBtn.Font = Enum.Font.GothamBold; closeBtn.TextColor3 = Color3.fromRGB(255,255,255)
    closeBtn.BackgroundColor3 = Color3.fromRGB(170,60,60); makeCorner(closeBtn,8); makeStroke(closeBtn, Color3.fromRGB(0,0,0),1,0.9)

    local minBtn = Instance.new("TextButton", titleBar)
    minBtn.Size = UDim2.fromOffset(36,28); minBtn.Position = UDim2.new(1, -92, 0, 12)
    minBtn.Text = "â€”"; minBtn.Font = Enum.Font.GothamBold; minBtn.TextColor3 = Color3.fromRGB(255,255,255)
    minBtn.BackgroundColor3 = Color3.fromRGB(110,110,110); makeCorner(minBtn,8); makeStroke(minBtn, Color3.fromRGB(0,0,0),1,0.9)

    local tabsPanel = Instance.new("Frame", frame)
    tabsPanel.Size = UDim2.fromOffset(164, height - 108); tabsPanel.Position = UDim2.new(0, 12, 0, 68)
    tabsPanel.BackgroundColor3 = (opts.Theme and opts.Theme.TabsBg) or GitanXUI.DefaultTheme.TabsBg
    makeCorner(tabsPanel, 10); makeStroke(tabsPanel, Color3.fromRGB(0,0,0),1,0.9)

    local contentPanel = Instance.new("Frame", frame)
    contentPanel.Size = UDim2.new(1, -188, 1, -108); contentPanel.Position = UDim2.new(0, 176, 0, 68)
    contentPanel.BackgroundColor3 = (opts.Theme and opts.Theme.ContentBg) or GitanXUI.DefaultTheme.ContentBg
    makeCorner(contentPanel, 10); makeStroke(contentPanel, Color3.fromRGB(0,0,0),1,0.9)

    local tabsList = Instance.new("UIListLayout", tabsPanel)
    tabsList.Padding = UDim.new(0,8); tabsList.SortOrder = Enum.SortOrder.LayoutOrder; tabsList.VerticalAlignment = Enum.VerticalAlignment.Top

    local contentList = Instance.new("UIListLayout", contentPanel)
    contentList.Padding = UDim.new(0,12); contentList.SortOrder = Enum.SortOrder.LayoutOrder

    local window = {
        ScreenGui = sg,
        Frame = frame,
        TitleBar = titleBar,
        Title = titleLabel,
        Subtitle = subtitle,
        TabsPanel = tabsPanel,
        ContentPanel = contentPanel,
        Theme = opts.Theme or GitanXUI.DefaultTheme,
        Tabs = {},
        _notifQueue = {},
    }

    -- Dragging window
    do
        local dragging, dragStart, startPos
        titleBar.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true; dragStart = input.Position; startPos = frame.Position
                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then dragging = false end
                end)
            end
        end)
        UserInputService.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local delta = input.Position - dragStart
                frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end)
    end

    -- Minimize & Close
    do
        local minimized = false
        minBtn.MouseButton1Click:Connect(function()
            minimized = not minimized
            if minimized then
                safeTween(contentPanel, {Size = UDim2.new(1, -188, 0, 0)}, 0.16)
                for _,c in ipairs(contentPanel:GetChildren()) do if c:IsA("GuiObject") then c.Visible = false end end
            else
                for _,c in ipairs(contentPanel:GetChildren()) do if c:IsA("GuiObject") then c.Visible = true end end
                safeTween(contentPanel, {Size = UDim2.new(1, -188, 1, -108)}, 0.16)
            end
        end)
        closeBtn.MouseButton1Click:Connect(function()
            if window.ScreenGui then window.ScreenGui:Destroy() end
        end)
    end

    -- CreateTab API
    function window:CreateTab(name, icon)
        local idx = #self.Tabs + 1
        local btn = Instance.new("TextButton", self.TabsPanel)
        btn.Name = "TabBtn_" .. tostring(name)
        btn.Size = UDim2.new(1, -20, 0, 44)
        btn.Position = UDim2.new(0, 10, 0, (idx-1) * 52 + 8)
        btn.BackgroundColor3 = Color3.fromRGB(40,40,46)
        btn.Text = (icon and (icon .. "  ") or "") .. tostring(name)
        btn.Font = Enum.Font.Gotham; btn.TextSize = 14; btn.TextColor3 = self.Theme.Text; btn.TextXAlignment = Enum.TextXAlignment.Left
        makeCorner(btn, 8); makeStroke(btn, Color3.fromRGB(0,0,0),1,0.9)

        local content = Instance.new("Frame", self.ContentPanel)
        content.Name = "Content_" .. tostring(name)
        content.Size = UDim2.new(1, -24, 0, 0)
        content.BackgroundTransparency = 1
        content.Visible = false
        content.LayoutOrder = idx

        local innerLayout = Instance.new("UIListLayout", content)
        innerLayout.SortOrder = Enum.SortOrder.LayoutOrder; innerLayout.Padding = UDim.new(0, 10)

        local tab = {Name = name, Button = btn, Content = content}
        table.insert(self.Tabs, tab)

        btn.MouseEnter:Connect(function() safeTween(btn, {BackgroundColor3 = Color3.fromRGB(48,48,54)}, 0.12) end)
        btn.MouseLeave:Connect(function() if not content.Visible then safeTween(btn, {BackgroundColor3 = Color3.fromRGB(40,40,46)}, 0.12) end end)
        btn.MouseButton1Click:Connect(function()
            for _, t in ipairs(self.Tabs) do
                t.Content.Visible = false
                t.Button.BackgroundColor3 = Color3.fromRGB(40,40,46)
            end
            content.Visible = true
            btn.BackgroundColor3 = self.Theme.Accent
        end)

        if #self.Tabs == 1 then
            btn.BackgroundColor3 = self.Theme.Accent; content.Visible = true
        end

        -- CreateSection
        function tab:CreateSection(title)
            local sec = Instance.new("Frame", self.Content)
            sec.Size = UDim2.new(1, 0, 0, 110)
            sec.BackgroundColor3 = Color3.fromRGB(24,24,26)
            makeCorner(sec, 10)
            local pad = Instance.new("UIPadding", sec)
            pad.PaddingLeft = UDim.new(0,12); pad.PaddingTop = UDim.new(0,10)

            local lbl = Instance.new("TextLabel", sec)
            lbl.Size = UDim2.new(1, -20, 0, 20); lbl.Position = UDim2.new(0,6,0,6)
            lbl.BackgroundTransparency = 1; lbl.Text = title or ""; lbl.Font = Enum.Font.GothamBold
            lbl.TextColor3 = window.Theme.Text; lbl.TextSize = 14; lbl.TextXAlignment = Enum.TextXAlignment.Left

            local inner = Instance.new("Frame", sec)
            inner.Size = UDim2.new(1, -20, 1, -36); inner.Position = UDim2.new(0,10,0,30)
            inner.BackgroundTransparency = 1
            local innerLayout = Instance.new("UIListLayout", inner)
            innerLayout.SortOrder = Enum.SortOrder.LayoutOrder; innerLayout.Padding = UDim.new(0,8)

            local sectionObj = {}

            -- CreateButton
            function sectionObj:CreateButton(opts)
                local text, callback = "Button", function() end
                if type(opts) == "table" then text = opts.Name or text; callback = opts.Callback or callback else text = tostring(opts) end
                local b = Instance.new("TextButton", inner)
                b.Size = UDim2.new(1,0,0,36)
                b.BackgroundColor3 = window.Theme.Primary
                b.Text = text; b.Font = Enum.Font.Gotham; b.TextSize = 14; b.TextColor3 = window.Theme.Text
                makeCorner(b, 8); makeStroke(b, Color3.fromRGB(0,0,0),1,0.9)
                b.MouseEnter:Connect(function() safeTween(b, {BackgroundColor3 = Color3.fromRGB(68,68,76)}, 0.12) end)
                b.MouseLeave:Connect(function() safeTween(b, {BackgroundColor3 = window.Theme.Primary}, 0.12) end)
                b.MouseButton1Click:Connect(function(px,py)
                    pcall(function() ripple(b, px - b.AbsolutePosition.X, py - b.AbsolutePosition.Y, Color3.fromRGB(255,255,255)) end)
                    pcall(callback)
                end)
                return b
            end

            -- CreateToggle
            function sectionObj:CreateToggle(opts)
                local name = opts.Name or "Toggle"; local default = opts.Default or false; local callback = opts.Callback or function() end
                local container = Instance.new("Frame", inner); container.Size = UDim2.new(1,0,0,36); container.BackgroundTransparency = 1

                local label = Instance.new("TextLabel", container)
                label.Size = UDim2.new(1, -100, 1, 0); label.Position = UDim2.new(0,8,0,0)
                label.BackgroundTransparency = 1; label.Text = name; label.Font = Enum.Font.Gotham
                label.TextColor3 = window.Theme.Text; label.TextSize = 14; label.TextXAlignment = Enum.TextXAlignment.Left

                local box = Instance.new("Frame", container)
                box.Size = UDim2.fromOffset(56,28); box.Position = UDim2.new(1, -72, 0, 4)
                box.BackgroundColor3 = default and window.Theme.Accent or Color3.fromRGB(60,60,64)
                makeCorner(box, 16); makeStroke(box, Color3.fromRGB(0,0,0),1,0.9)

                local knob = Instance.new("Frame", box)
                knob.Size = UDim2.fromOffset(22,22)
                knob.Position = default and UDim2.new(1, -26, 0, 3) or UDim2.new(0, 4, 0, 3)
                knob.BackgroundColor3 = Color3.fromRGB(245,245,245)
                makeCorner(knob, 12); makeStroke(knob, Color3.fromRGB(0,0,0),1,0.9)

                local btn = Instance.new("TextButton", box)
                btn.Size = UDim2.fromScale(1,1); btn.BackgroundTransparency = 1; btn.Text = ""; btn.AutoButtonColor = false

                local state = default
                local function applyState(s, anim)
                    state = s and true or false
                    if state then
                        if anim then safeTween(knob, {Position = UDim2.new(1, -26, 0, 3)}, 0.14); safeTween(box, {BackgroundColor3 = window.Theme.Accent}, 0.14)
                        else knob.Position = UDim2.new(1,-26,0,3); box.BackgroundColor3 = window.Theme.Accent end
                    else
                        if anim then safeTween(knob, {Position = UDim2.new(0, 4, 0, 3)}, 0.14); safeTween(box, {BackgroundColor3 = Color3.fromRGB(60,60,64)}, 0.14)
                        else knob.Position = UDim2.new(0,4,0,3); box.BackgroundColor3 = Color3.fromRGB(60,60,64) end
                    end
                end

                btn.MouseButton1Click:Connect(function()
                    applyState(not state, true)
                    pcall(callback, state)
                end)

                return {
                    Button = btn,
                    GetState = function() return state end,
                    SetState = function(v) applyState(v, false); pcall(callback, state) end
                }
            end

            -- CreateSlider (with Step, Reversed, Decimals, touch support, float label)
            function sectionObj:CreateSlider(opts)
                local labelText = opts.Name or "Slider"
                local min = (opts.Min ~= nil) and opts.Min or 0
                local max = (opts.Max ~= nil) and opts.Max or 1
                local initial = (opts.Default ~= nil) and opts.Default or min
                local callback = opts.Callback or function() end
                local step = opts.Step -- optional
                local reversed = opts.Reversed and true or false
                local decimals = opts.Decimals -- optional

                if max == min then max = min + 1 end

                if step == nil then
                    if math.abs(min - math.floor(min)) < 1e-6 and math.abs(max - math.floor(max)) < 1e-6 then
                        step = 1
                    else
                        step = 0
                    end
                end
                if step == 0 then step = nil end

                local cont = Instance.new("Frame", inner)
                cont.Size = UDim2.new(1, 0, 0, 56); cont.BackgroundTransparency = 1

                local lbl = Instance.new("TextLabel", cont)
                lbl.Size = UDim2.new(1, -120, 0, 18); lbl.Position = UDim2.new(0, 8, 0, 0)
                lbl.BackgroundTransparency = 1; lbl.Font = Enum.Font.Gotham; lbl.Text = labelText; lbl.TextColor3 = window.Theme.Text; lbl.TextSize = 13; lbl.TextXAlignment = Enum.TextXAlignment.Left

                local valLbl = Instance.new("TextLabel", cont)
                valLbl.Size = UDim2.new(0, 64, 0, 18); valLbl.Position = UDim2.new(1, -80, 0, 0)
                valLbl.BackgroundTransparency = 1; valLbl.Font = Enum.Font.Gotham; valLbl.Text = tostring(initial); valLbl.TextSize = 13; valLbl.TextColor3 = window.Theme.Muted

                local floatLbl = Instance.new("TextLabel", cont)
                floatLbl.Size = UDim2.new(0, 60, 0, 20); floatLbl.AnchorPoint = Vector2.new(0.5, 1)
                floatLbl.Position = UDim2.new(0, 0, 0, 22); floatLbl.BackgroundTransparency = 0.45
                floatLbl.BackgroundColor3 = Color3.fromRGB(0,0,0); floatLbl.Font = Enum.Font.GothamBold; floatLbl.TextSize = 12
                floatLbl.TextColor3 = window.Theme.Text; makeCorner(floatLbl, 6); floatLbl.Visible = false

                local bar = Instance.new("Frame", cont)
                bar.Size = UDim2.new(1, -24, 0, 12); bar.Position = UDim2.new(0, 12, 0, 34)
                bar.BackgroundColor3 = Color3.fromRGB(40,40,44); makeCorner(bar, 6); makeStroke(bar, Color3.fromRGB(0,0,0),1,0.9)

                local relInit = clamp((initial - min) / (max - min), 0, 1)
                local relRawInit = reversed and (1 - relInit) or relInit

                local fill = Instance.new("Frame", bar)
                fill.Size = UDim2.new(relRawInit, 0, 1, 0); fill.BackgroundColor3 = window.Theme.Accent; makeCorner(fill, 6)

                local handle = Instance.new("Frame", bar)
                handle.Size = UDim2.fromOffset(14,14); handle.AnchorPoint = Vector2.new(0.5, 0.5)
                handle.Position = UDim2.new(relRawInit, 0, 0.5, 0); handle.BackgroundColor3 = Color3.fromRGB(250,250,250)
                makeCorner(handle, 8); makeStroke(handle, Color3.fromRGB(0,0,0),1,0.9)

                local dragging = false

                local function quantize(raw)
                    if step and step > 0 then
                        local n = math.floor((raw - min)/step + 0.5)
                        return clamp(min + n * step, min, max)
                    end
                    return raw
                end

                local function fmt(v)
                    if decimals ~= nil then return string.format("%." .. tostring(decimals) .. "f", v) end
                    if step and step > 0 and math.abs(step - math.floor(step)) < 1e-6 then return tostring(math.floor(v + 0.5)) end
                    if math.abs(v - math.floor(v)) < 1e-6 then return tostring(math.floor(v)) end
                    return string.format("%.2f", v)
                end

                local function updateFloat(visualRel, val)
                    if not floatLbl then return end
                    floatLbl.Visible = true
                    floatLbl.Position = UDim2.new(visualRel, 0, 0, 22)
                    floatLbl.Text = fmt(val)
                end

                local function updateFromX(x)
                    local absX = bar.AbsolutePosition.X
                    local absW = bar.AbsoluteSize.X
                    if absW <= 0 then return end
                    local relRaw = clamp((x - absX) / absW, 0, 1)
                    local relMapped = reversed and (1 - relRaw) or relRaw
                    local rawVal = min + relMapped * (max - min)
                    local q = quantize(rawVal)
                    local relMappedAfter = (q - min) / (max - min)
                    local visualRel = reversed and (1 - relMappedAfter) or relMappedAfter

                    fill.Size = UDim2.new(visualRel, 0, 1, 0)
                    handle.Position = UDim2.new(visualRel, 0, 0.5, 0)
                    valLbl.Text = fmt(q)
                    updateFloat(visualRel, q)
                    pcall(callback, q)
                end

                local absConn
                absConn = bar:GetPropertyChangedSignal("AbsoluteSize"):Connect(function()
                    if bar.AbsoluteSize.X > 0 then
                        local relMapped = clamp((initial - min)/(max - min), 0, 1)
                        local visual = reversed and (1 - relMapped) or relMapped
                        fill.Size = UDim2.new(visual, 0, 1, 0)
                        handle.Position = UDim2.new(visual, 0, 0.5, 0)
                        valLbl.Text = fmt(quantize(initial))
                        floatLbl.Text = fmt(quantize(initial))
                        floatLbl.Visible = false
                        if absConn then absConn:Disconnect(); absConn = nil end
                    end
                end)

                bar.InputBegan:Connect(function(inp)
                    if inp.UserInputType == Enum.UserInputType.MouseButton1 or inp.UserInputType == Enum.UserInputType.Touch then
                        dragging = true; updateFromX(inp.Position.X)
                    end
                end)
                bar.InputChanged:Connect(function(inp)
                    if dragging and inp.UserInputType == Enum.UserInputType.MouseMovement then updateFromX(inp.Position.X) end
                end)
                bar.InputEnded:Connect(function(inp)
                    if inp.UserInputType == Enum.UserInputType.MouseButton1 or inp.UserInputType == Enum.UserInputType.Touch then
                        dragging = false
                        delay(0.12, function() if floatLbl then floatLbl.Visible = false end end)
                    end
                end)

                handle.InputBegan:Connect(function(inp)
                    if inp.UserInputType == Enum.UserInputType.MouseButton1 or inp.UserInputType == Enum.UserInputType.Touch then dragging = true end
                end)
                handle.InputChanged:Connect(function(inp)
                    if dragging and inp.UserInputType == Enum.UserInputType.MouseMovement then updateFromX(inp.Position.X) end
                end)
                handle.InputEnded:Connect(function(inp)
                    if inp.UserInputType == Enum.UserInputType.MouseButton1 or inp.UserInputType == Enum.UserInputType.Touch then
                        dragging = false
                        delay(0.12, function() if floatLbl then floatLbl.Visible = false end end)
                    end
                end)

                local function SetValue(v)
                    v = tonumber(v) or min; v = clamp(v, min, max); v = quantize(v)
                    local relMapped = (v - min) / (max - min)
                    local visual = reversed and (1 - relMapped) or relMapped
                    fill.Size = UDim2.new(visual, 0, 1, 0)
                    handle.Position = UDim2.new(visual, 0, 0.5, 0)
                    valLbl.Text = fmt(v)
                    pcall(callback, v)
                end

                local function GetValue()
                    return tonumber(valLbl.Text) or min
                end

                SetValue(initial)

                return {Container = cont, GetValue = GetValue, SetValue = SetValue}
            end

            -- CreateDropdown
            function sectionObj:CreateDropdown(opts)
                local label = opts.Name or "Dropdown"; local items = opts.Items or {}; local callback = opts.Callback or function() end
                local container = Instance.new("Frame", inner); container.Size = UDim2.new(1,0,0,36); container.BackgroundTransparency = 1

                local lbl = Instance.new("TextLabel", container)
                lbl.Size = UDim2.new(1, -160, 1, 0); lbl.Position = UDim2.new(0,8,0,0)
                lbl.BackgroundTransparency = 1; lbl.Text = label; lbl.Font = Enum.Font.Gotham; lbl.TextColor3 = window.Theme.Text; lbl.TextSize = 13

                local btn = Instance.new("TextButton", container)
                btn.Size = UDim2.new(0,140,0,28); btn.Position = UDim2.new(1, -152, 0, 4)
                btn.BackgroundColor3 = Color3.fromRGB(48,48,52); btn.Text = items[1] or "Choose"; btn.Font = Enum.Font.Gotham; btn.TextColor3 = window.Theme.Text
                makeCorner(btn, 6); makeStroke(btn, Color3.fromRGB(0,0,0),1,0.9)

                local list = Instance.new("Frame", container)
                list.Size = UDim2.new(0,160,0, math.min(6, #items) * 30); list.Position = UDim2.new(1, -152, 1, 6)
                list.BackgroundColor3 = Color3.fromRGB(36,36,40); list.Visible = false; makeCorner(list, 8); makeStroke(list, Color3.fromRGB(0,0,0),1,0.9)

                for i,it in ipairs(items) do
                    local item = Instance.new("TextButton", list)
                    item.Size = UDim2.new(1, -8, 0, 28); item.Position = UDim2.new(0, 4, 0, (i-1)*30)
                    item.BackgroundTransparency = 1; item.Text = it; item.Font = Enum.Font.Gotham; item.TextColor3 = window.Theme.Text; item.TextSize = 13
                    item.TextXAlignment = Enum.TextXAlignment.Left
                    item.MouseEnter:Connect(function() safeTween(item, {BackgroundTransparency = 0.6}, 0.08) end)
                    item.MouseLeave:Connect(function() safeTween(item, {BackgroundTransparency = 1}, 0.08) end)
                    item.MouseButton1Click:Connect(function() btn.Text = it; list.Visible = false; pcall(callback, it) end)
                end

                btn.MouseButton1Click:Connect(function()
                    if #items == 0 then return end
                    list.Visible = not list.Visible
                end)

                return {Button = btn, Get = function() return btn.Text end}
            end

            -- CreateTextbox
            function sectionObj:CreateTextbox(opts)
                local placeholder = opts.Placeholder or ""; local cb = opts.Callback
                local box = Instance.new("TextBox", inner)
                box.Size = UDim2.new(1,0,0,32); box.BackgroundColor3 = Color3.fromRGB(36,36,40); box.TextColor3 = window.Theme.Text
                box.PlaceholderText = placeholder; box.Font = Enum.Font.Gotham; box.TextSize = 14
                makeCorner(box, 8); makeStroke(box, Color3.fromRGB(0,0,0),1,0.9)
                box.ClearTextOnFocus = false
                box.FocusLost:Connect(function(enter) if enter and cb then pcall(cb, box.Text) end end)
                return {Box = box, Get = function() return box.Text end}
            end

            -- CreateKeybind
            function sectionObj:CreateKeybind(opts)
                local label = opts.Name or "Keybind"; local def = opts.Default or "None"; local cb = opts.Callback or function() end
                local container = Instance.new("Frame", inner); container.Size = UDim2.new(1,0,0,36); container.BackgroundTransparency = 1
                local lbl = Instance.new("TextLabel", container); lbl.Size = UDim2.new(1, -180, 1, 0); lbl.Position = UDim2.new(0,8,0,0)
                lbl.BackgroundTransparency = 1; lbl.Text = label; lbl.Font = Enum.Font.Gotham; lbl.TextColor3 = window.Theme.Text; lbl.TextSize = 13

                local btn = Instance.new("TextButton", container)
                btn.Size = UDim2.new(0,160,0,28); btn.Position = UDim2.new(1, -172, 0, 4)
                btn.BackgroundColor3 = Color3.fromRGB(46,46,50); btn.Text = tostring(def); btn.Font = Enum.Font.Gotham; btn.TextColor3 = window.Theme.Text
                makeCorner(btn, 6); makeStroke(btn, Color3.fromRGB(0,0,0),1,0.9)

                local capturing = false; local conn
                btn.MouseButton1Click:Connect(function()
                    btn.Text = "Press..."; capturing = true
                    conn = UserInputService.InputBegan:Connect(function(input, gp)
                        if gp then return end
                        if capturing and input.UserInputType == Enum.UserInputType.Keyboard then
                            local k = input.KeyCode.Name; btn.Text = k; capturing = false; pcall(cb, k)
                            if conn then conn:Disconnect(); conn = nil end
                        end
                    end)
                end)
                return {Button = btn, Get = function() return btn.Text end}
            end

            -- CreateColorPicker (RGB sliders)
            function sectionObj:CreateColorPicker(opts)
                local default = opts.Default or {80,160,255}; local cb = opts.Callback or function() end
                local container = Instance.new("Frame", inner); container.Size = UDim2.new(1,0,0,96); container.BackgroundTransparency = 1
                local lbl = Instance.new("TextLabel", container); lbl.Size = UDim2.new(1, -16, 0, 18); lbl.Position = UDim2.new(0,8,0,0)
                lbl.BackgroundTransparency = 1; lbl.Font = Enum.Font.Gotham; lbl.Text = opts.Name or "Color"; lbl.TextColor3 = window.Theme.Text; lbl.TextSize = 13

                local preview = Instance.new("Frame", container); preview.Size = UDim2.fromOffset(56,56); preview.Position = UDim2.new(1,-72,0,22)
                preview.BackgroundColor3 = Color3.fromRGB(default[1], default[2], default[3]); makeCorner(preview,10); makeStroke(preview, Color3.fromRGB(0,0,0),1,0.9)

                local function smallSlider(y, labelTxt, init)
                    local scont = Instance.new("Frame", container); scont.Size = UDim2.new(1, -96, 0, 22); scont.Position = UDim2.new(0,8,0,y); scont.BackgroundTransparency = 1
                    local name = Instance.new("TextLabel", scont); name.Size = UDim2.new(0,28,1,0); name.BackgroundTransparency = 1; name.Text = labelTxt; name.Font = Enum.Font.GothamBold; name.TextSize = 12; name.TextColor3 = window.Theme.Text
                    local bar = Instance.new("Frame", scont); bar.Size = UDim2.new(1, -60, 1, 0); bar.Position = UDim2.new(0,36,0,0); bar.BackgroundColor3 = Color3.fromRGB(36,36,40); makeCorner(bar,6); makeStroke(bar, Color3.fromRGB(0,0,0),1,0.9)
                    local fill = Instance.new("Frame", bar); local iv = clamp((init or 128), 0, 255)
                    fill.Size = UDim2.new(iv/255, 0, 1, 0); fill.BackgroundColor3 = GitanXUI.DefaultTheme.Accent; makeCorner(fill,6)
                    local valLbl = Instance.new("TextLabel", scont); valLbl.Size = UDim2.new(0,28,1,0); valLbl.Position = UDim2.new(1,-28,0,0); valLbl.BackgroundTransparency = 1; valLbl.Text = tostring(math.floor(iv)); valLbl.Font = Enum.Font.Gotham; valLbl.TextSize = 12; valLbl.TextColor3 = window.Theme.Muted

                    local dragging = false
                    local function updateFromX(x)
                        if bar.AbsoluteSize.X <= 0 then return end
                        local rel = clamp((x - bar.AbsolutePosition.X) / bar.AbsoluteSize.X, 0, 1)
                        fill.Size = UDim2.new(rel, 0, 1, 0)
                        valLbl.Text = tostring(math.floor(rel * 255))
                    end
                    bar.InputBegan:Connect(function(inp) if inp.UserInputType == Enum.UserInputType.MouseButton1 or inp.UserInputType == Enum.UserInputType.Touch then dragging = true; updateFromX(inp.Position.X) end end)
                    bar.InputChanged:Connect(function(inp) if dragging and inp.UserInputType == Enum.UserInputType.MouseMovement then updateFromX(inp.Position.X) end end)
                    bar.InputEnded:Connect(function(inp) if inp.UserInputType == Enum.UserInputType.MouseButton1 or inp.UserInputType == Enum.UserInputType.Touch then dragging = false end end)
                    return fill, valLbl
                end

                local rfill, rlbl = smallSlider(22, "R", default[1] or 80)
                local gfill, glbl = smallSlider(44, "G", default[2] or 160)
                local bfill, blbl = smallSlider(66, "B", default[3] or 255)
                container._r, container._g, container._b = rlbl, glbl, blbl

                spawn(function()
                    while container.Parent do
                        local r = tonumber(container._r.Text) or 0
                        local g = tonumber(container._g.Text) or 0
                        local b = tonumber(container._b.Text) or 0
                        local c = Color3.fromRGB(clamp(r,0,255), clamp(g,0,255), clamp(b,0,255))
                        preview.BackgroundColor3 = c
                        pcall(cb, c)
                        wait(0.12)
                    end
                end)

                return {
                    Container = container,
                    Get = function()
                        local r = tonumber(container._r.Text) or 0
                        local g = tonumber(container._g.Text) or 0
                        local b = tonumber(container._b.Text) or 0
                        return Color3.fromRGB(clamp(r,0,255), clamp(g,0,255), clamp(b,0,255))
                    end,
                    Set = function(col)
                        if typeof(col) == "Color3" then
                            local r,g,b = math.floor(col.R*255+0.5), math.floor(col.G*255+0.5), math.floor(col.B*255+0.5)
                            container._r.Text, container._g.Text, container._b.Text = tostring(clamp(r,0,255)), tostring(clamp(g,0,255)), tostring(clamp(b,0,255))
                        elseif type(col) == "table" and #col >= 3 then
                            container._r.Text, container._g.Text, container._b.Text = tostring(clamp(math.floor(col[1]),0,255)), tostring(clamp(math.floor(col[2]),0,255)), tostring(clamp(math.floor(col[3]),0,255))
                        end
                    end
                }
            end

            return sectionObj
        end

        return tab
    end

    -- window API
    function window:SetVisible(v) if self.ScreenGui then self.ScreenGui.Enabled = v end end
    function window:Close() if self.ScreenGui then self.ScreenGui:Destroy() end end
    function window:Notify(t1, t2, d) enqueueNotification(self, t1, t2, d) end

    function window:SaveConfig(name, tbl)
        local ok, json = pcall(function() return HttpService:JSONEncode(tbl) end)
        if ok then
            local pl = Players.LocalPlayer
            if pl then pl:SetAttribute("GitanXUI_Config_" .. tostring(name), json) end
        end
    end
    function window:LoadConfig(name)
        local pl = Players.LocalPlayer
        if pl then
            local attr = pl:GetAttribute("GitanXUI_Config_" .. tostring(name))
            if attr and type(attr) == "string" then
                local ok, tbl = pcall(function() return HttpService:JSONDecode(attr) end)
                if ok then return tbl end
            end
        end
        return nil
    end

    window.CreateTab = window.CreateTab
    return window
end

-- Demo (quick)
function GitanXUI.Demo()
    local w = GitanXUI.CreateWindow({Name="GitanX_Demo", Title="GitanX UI (Perfect)", Size = Vector2.new(860, 560)})
    local home = w:CreateTab("Home", "ðŸ ")
    local s1 = home:CreateSection("Welcome")
    s1:CreateButton({Name="Say Hello", Callback=function() w:Notify("Hello","Welcome to GitanX",2) end})
    s1:CreateToggle({Name="Demo Toggle", Default=false, Callback=function(v) w:Notify("Demo Toggle", tostring(v), 1.2) end})
    s1:CreateSlider({Name="Demo Slider", Min=1, Max=4, Default=2, Step=1, Callback=function(v) print("slider",v) end})
    s1:CreateSlider({Name="Smooth Slider", Min=0, Max=1, Default=0.5, Decimals=2, Callback=function(v) print("smooth",v) end})
    local fish = w:CreateTab("Fishing", "ðŸŽ£")
    local sf = fish:CreateSection("Actions")
    sf:CreateToggle({Name="Auto Fish", Default=false, Callback=function(v) w:Notify("AutoFish", v and "ON" or "OFF", 1) end})
    sf:CreateSlider({Name="Cast â†’ Reel", Min=0.1, Max=5, Default=1.2, Decimals=2, Callback=function(v) print("cast->reel", v) end})
    sf:CreateButton({Name="Rescan Remotes", Callback=function() w:Notify("Scan", "Rescan requested", 1) end})
    return w
end

return GitanXUI
